<?php/*///////////////////////////////////////////////////////////////////////Part of the code from the book Building Findable Websites: Web Standards, SEO, and Beyondby Aarron Walter (aarron@buildingfindablewebsites.com)http://buildingfindablewebsites.comDistrbuted under Creative Commons licensehttp://creativecommons.org/licenses/by-sa/3.0/us////////////////////////////////////////////////////////////////////////*/use \DrewM\MailChimp\MailChimp;function storeAddress(){	// Specific to Joomla to call the API Key and List ID in a session var from the mod_s5_contact_popup.php page	define( '_JEXEC', 1 );	define( 'JPATH_BASE', dirname(dirname(dirname(dirname(__FILE__)))));	require_once ( JPATH_BASE .'/includes/defines.php' );	require_once ( JPATH_BASE .'/includes/framework.php' );	$mainframe = JFactory::getApplication('site');	$mainframe->initialise();	$language = JFactory::getlanguage();	$language->load('mod_s5_mailchimp_signup');	$session = JFactory::getSession();	$mailchimp_apikey = $session->get('mailchimp_apikey');	$mailchimp_listid = $session->get('mailchimp_listid');		// Validation	if(!$_GET['email']){ return JText::_("MAIL_CHIMP_SUCCESS_NO_EMAIL"); } 	if(!preg_match("/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*$/i", $_GET['email'])) {		return "Email address is invalid"; 	}	require_once('MCAPI.class.php');	$api = new MailChimp($mailchimp_apikey);	$list_id = trim($mailchimp_listid);	$result = $api->post("lists/$list_id/members", [				'email_address' => $_GET['email'],				'status' => 'subscribed'			]);	if($api->success()) {		return JText::_('MAIL_CHIMP_SUCCESS');	} else {		return 'Error: ' . $api->getLastError();;	}	}// If being called via ajax, autorun the functionif($_GET['ajax']){ echo storeAddress(); }?>